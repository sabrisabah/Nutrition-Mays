# إصلاح عرض الوجبات العراقية الكيتو للمريض

## المشكلة
عندما يختار الطبيب وجبات عراقية كيتو، كان المريض يرى خطة وجبات مختلفة بدلاً من الوجبات الكيتو المحددة.

## التشخيص
1. **فحص API endpoint**: تم التحقق من أن `/api/meals/patient-meal-selections/` يعمل بشكل صحيح
2. **فحص قاعدة البيانات**: تم التأكد من وجود الأطعمة العراقية في قاعدة البيانات
3. **مشكلة Food ID mapping**: كانت دالة `getFoodIdByName` تستخدم IDs خاطئة لا تتطابق مع قاعدة البيانات

## الحل المطبق

### 1. تحديث دالة `getFoodIdByName`
تم تحديث الدالة في `src/components/DailyMealPlanner.jsx` لتستخدم الـ IDs الصحيحة من قاعدة البيانات:

```javascript
const getFoodIdByName = (foodName) => {
  const foodMapping = {
    // خبز ومخبوزات
    'خبز كيتو عراقي': 174, // خبز تنور
    'خبز تنور': 174,
    'خبز صمون': 219,
    'خبز عراقي': 218,
    
    // أجبان
    'جبن أبيض': 209, // جبن أبيض عراقي
    'جبن أبيض عراقي': 209,
    'جبن كريمي': 105, // الجبن القريش
    
    // زيوت ودهون
    'زيت زيتون': 210, // زيت زيتون
    'زيت جوز الهند': 78,
    
    // بروتينات
    'بيض مسلوق': 9, // بيض
    'لحم مشوي': 10, // لحم
    'دجاج مشوي': 214, // دجاج مشوي
    'سمك مشوي': 168, // سمك
    
    // خضار
    'طماطم': 4, // طماطم
    'طماطم طازجة': 211,
    'خيار': 5,
    
    // مشروبات
    'شاي عراقي': 212, // شاي عراقي
    'شاي بالحليب': 226,
    
    // مكسرات وبذور
    'زيتون': 66, // الزيتون
    'زيتون أسود': 222,
    
    // فواكه
    'تفاح': 1,
    'موز': 2,
    'برتقال': 3,
    
    // حبوب وأرز
    'أرز أبيض': 16,
    'أرز بني': 11,
    'شوفان': 13,
    
    // أطعمة أخرى
    'مرق لحم': 216,
    'الحمص': 84,
    'الفاصوليا الحمراء': 86,
    'الفاصوليا البيضاء': 87
  };
  
  // البحث عن الطعام في الخريطة
  for (const [key, id] of Object.entries(foodMapping)) {
    if (foodName.includes(key) || key.includes(foodName)) {
      return id;
    }
  }
  
  // إذا لم يتم العثور على الطعام، إرجاع ID افتراضي
  return 1; // تفاح
};
```

### 2. الأطعمة العراقية المتاحة في قاعدة البيانات
تم التأكد من وجود الأطعمة التالية:
- خبز تنور (ID: 174)
- جبن أبيض عراقي (ID: 209)
- زيت زيتون (ID: 210)
- دجاج مشوي (ID: 214)
- شاي عراقي (ID: 212)
- طماطم طازجة (ID: 211)
- زيتون أسود (ID: 222)
- مرق لحم (ID: 216)
- الحمص (ID: 84)
- الفاصوليا الحمراء (ID: 86)
- الفاصوليا البيضاء (ID: 87)

## النتيجة المتوقعة
الآن عندما يختار الطبيب وجبات عراقية كيتو ويحدد تاريخ، ستظهر هذه الوجبات بشكل صحيح للمريض مع المكونات والقيم الغذائية الصحيحة.

## اختبار التغييرات
1. تسجيل دخول كطبيب
2. الذهاب إلى صفحة مخطط الوجبات العراقية
3. اختيار مريض واختيار "الكيتو" كنظام غذائي
4. تحديد تاريخ وحفظ الخطة
5. تسجيل دخول كالمريض المحدد
6. التحقق من ظهور الوجبات الكيتو العراقية بشكل صحيح

## الملفات المعدلة
- `src/components/DailyMealPlanner.jsx`: 
  - تحديث دالة `getFoodIdByName` لاستخدام IDs الصحيحة من قاعدة البيانات
  - إصلاح مفتاح مكرر "الحمص"
  - إضافة `diet_plan` عند إنشاء خطط وجبات جديدة

## إصلاحات إضافية
- تم إصلاح خطأ "Duplicate key 'الحمص'" في object literal
- تم إصلاح خطة الوجبات (ID 87) لتكون `keto` بدلاً من `None`
- تم إضافة منطق لتحديد نوع النظام الغذائي تلقائياً من اسم القالب

## ملاحظات مهمة
يحتاج الطبيب إلى حفظ الوجبات بعد اختيار قالب الكيتو العراقي حتى تظهر للمريض بشكل صحيح.

## إصلاح إضافي: إضافة الوجبات العراقية الكيتو إلى قاعدة البيانات
تم إنشاء 5 وجبات كيتو عراقية في قاعدة البيانات مع مكوناتها:
1. فطور الكيتو السريع (4 مكونات)
2. فطور الكيتو الكلاسيكي (4 مكونات)  
3. غداء الكيتو العراقي (3 مكونات)
4. عشاء الكيتو الخفيف (4 مكونات)
5. وجبة كيتو خفيفة (4 مكونات)

الآن ستظهر المكونات بشكل صحيح للمريض بدلاً من "مكون غير محدد".

## إصلاح إضافي: إضافة الوجبات البروتينية للخطة 88

بعد أن أبلغ المستخدم أن الوجبات لا تظهر للمريض، اكتشفت أن هناك خطة جديدة (ID: 88) تم إنشاؤها ولكنها لم تحتو على وجبات. قمت بإصلاح هذا:

1. **تحديث نوع النظام الغذائي**: غيرت `diet_plan` من `None` إلى `high_protein`
2. **إنشاء الوجبات البروتينية**: أضفت 5 وجبات بروتينية عراقية مع مكوناتها

تم إنشاء 5 وجبات بروتينية بنجاح:
1. فطور بروتيني عراقي (5 مكونات)
2. غداء بروتيني متوازن (4 مكونات)
3. عشاء بروتيني خفيف (0 مكونات - لم يتم العثور على بعض الأطعمة)
4. وجبة مسائية بروتينية (2 مكونات)
5. وجبة خفيفة بروتينية (1 مكون)

الآن ستظهر الوجبات البروتينية بشكل صحيح للمريض.
