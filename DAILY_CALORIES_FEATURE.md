# إضافة حقل السعرات الحرارية اليومية للمريض

## نظرة عامة
تم إضافة حقل السعرات الحرارية اليومية المخصصة للمريض في النظام، مما يسمح للطبيب بتحديد السعرات الحرارية المطلوبة لكل مريض بشكل فردي.

## التغييرات المنجزة

### 1. قاعدة البيانات
- **إضافة حقل جديد**: `daily_calories` في نموذج `PatientProfile`
- **نوع الحقل**: `IntegerField` مع إمكانية القيم الفارغة
- **الوصف**: "Daily calorie intake target"
- **Migration**: تم إنشاء migration `0010_patientprofile_daily_calories.py`

### 2. API (Backend)
- **تحديث Serializer**: تم تحديث `PatientProfileForPatientSerializer` ليتضمن حقل `daily_calories`
- **API Endpoint**: `DoctorPatientProfileView` يدعم الآن تحديث السعرات الحرارية
- **الصلاحيات**: الأطباء فقط يمكنهم تعديل السعرات الحرارية للمرضى

### 3. واجهة المستخدم (Frontend)

#### أ. واجهة اختيار المريض
- **الملف**: `src/components/DailyMealPlanner.jsx`
- **التحديث**: عرض السعرات الحرارية اليومية في معلومات المريض المختار
- **الشرط**: يتم عرض السعرات فقط إذا كانت محددة

#### ب. واجهة ملف المريض للطبيب
- **الملف**: `src/pages/doctor/PatientProfile.jsx`
- **التحديثات**:
  - إضافة حقل إدخال للسعرات الحرارية المخصصة في وضع التعديل
  - عرض السعرات الحرارية المخصصة في وضع العرض
  - عرض السعرات المحسوبة تلقائياً كمرجع
  - تحديث نموذج البيانات ليتضمن `daily_calories`

## الميزات الجديدة

### 1. حساب السعرات الحرارية التلقائي
- يتم حساب السعرات الحرارية تلقائياً باستخدام معادلة Mifflin-St Jeor
- يأخذ في الاعتبار: الوزن، الطول، الجنس، مستوى النشاط، والهدف
- يتم عرضها كمرجع للطبيب عند تحديد السعرات المخصصة

### 2. واجهة سهلة الاستخدام
- حقل إدخال مع قيود (800-5000 سعرة حرارية)
- عرض واضح للسعرات المخصصة مقابل المحسوبة
- تحديث فوري عند الحفظ

### 3. مرونة في الاستخدام
- السعرات المخصصة اختيارية
- إذا لم يتم تحديدها، يتم عرض السعرات المحسوبة تلقائياً
- يمكن للطبيب تعديلها في أي وقت

## كيفية الاستخدام

### للطبيب:
1. انتقل إلى ملف المريض
2. اضغط على "تعديل" في قسم المعلومات الأساسية
3. أدخل السعرات الحرارية المطلوبة في حقل "السعرات الحرارية اليومية المخصصة"
4. احفظ التغييرات

### في واجهة اختيار المريض:
- ستظهر السعرات الحرارية المخصصة (إن وجدت) في معلومات المريض المختار
- إذا لم تكن محددة، ستظهر السعرات المحسوبة تلقائياً

## الملفات المعدلة

### Backend:
- `accounts/models.py` - إضافة حقل `daily_calories`
- `accounts/serializers.py` - تحديث serializer
- `accounts/migrations/0010_patientprofile_daily_calories.py` - migration جديد

### Frontend:
- `src/components/DailyMealPlanner.jsx` - عرض السعرات في اختيار المريض
- `src/pages/doctor/PatientProfile.jsx` - إضافة حقل التعديل والعرض

## ملاحظات تقنية

- تم استخدام `IntegerField` بدلاً من `FloatField` لأن السعرات الحرارية عادة ما تكون أرقام صحيحة
- تم إضافة validation للقيم (800-5000) في الواجهة
- الحقل اختياري (`blank=True, null=True`) لمرونة أكبر
- تم الحفاظ على التوافق مع الكود الموجود

## الاختبار

لاختبار الميزة:
1. سجل دخول كطبيب
2. انتقل إلى ملف أي مريض
3. اضغط "تعديل" وأدخل سعرات حرارية مخصصة
4. احفظ وستظهر في واجهة اختيار المريض
